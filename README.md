## Local development

### Running local DynamoDB

1. Download from https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.DownloadingAndRunning.html
2. Extract and run `java -Djava.library.path=~/Documents/dynamodb/DynamoDBLocal_lib -jar ~/Documents/dynamodb/DynamoDBLocal.jar -sharedDb -dbPath ~/Documents/dynamodb/data`

### Tools

#### NoSQL Workbench GUI

Download from https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/workbench.html

#### Web GUI

Download from: https://github.com/aaronshaf/dynamodb-admin

#### CLI

Reference: https://docs.aws.amazon.com/cli/latest/reference/dynamodb/index.html


## Client registration
Client credentials can be generated by running `/scripts/generate-client.js` at the root of the repo. These credentials can then be used to register clients.

Example JSON object for client registration (note: this is stringified before it is passed to the `payload` property in the `client-registration.json` file):
```
{
  "application_type": "web",
  "authorization_signed_response_alg": "PS256",
  "client_id": "Client-ISOMER_TEST",
  "client_name": "ISOMER_TEST",
  "client_secret": "<some secret>", // this is generated for you if you run `scripts/generate-client.js` to generate client credentials
  "client_uri": "https://isomer.gov.sg",
  "contacts": [],
  "grant_types": ["authorization_code"],
  "id_token_signed_response_alg": "PS256",
  "introspection_signed_response_alg": "PS256",
  "jwks": {
    "keys": [<required>] // a JSON web key set - this is generated for you if you run `scripts/generate-client.js` to generate client credentials
  },
  "logo_uri": "https://raw.githubusercontent.com/isomerpages/isomerpages-isomergovsg/083c49bf8b2a309b0e76fb158db568fef9e32a31/images/isomer-logo.svg",
  "redirect_uris": ["http://localhost:4000"],
  "require_auth_time": false,
  "response_types": ["code"],
  "scope": "openid myinfo.name",
  "subject_type": "public",
  "token_endpoint_auth_method": "client_secret_basic", // for test accounts, this is set to "none"
  "userinfo_signed_response_alg": "PS256",
}
```

### Local registration
Note that this requires you to use the `PROVIDER_TABLE` env var.

```
aws dynamodb put-item \
  --cli-input-json 'file://<path to your client registration json>' \
  --table-name <PROVIDER_TABLE env var> \
  --endpoint-url http://localhost:8000 \
  --profile <your AWS profile>
```

aws dynamodb put-item \
  --cli-input-json 'file://scripts/client-registration.json' \
  --table-name ogpass-oidc-provider \
  --endpoint-url http://localhost:8000 \
  --profile ogpass-jiehao

# To-do
Add documentation on how OIDC provider works (Grant, Session, Client, Interaction)

Add documentation on SSO logic (allow passthrough if session exists, otherwise redirect to login/signup)
- this can be more granular (for example, if expired session exists, redirect to login page, otherwise, redirect to sign up page. Or, if user is not found, redirect user to sign up page)